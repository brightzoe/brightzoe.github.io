# 碰到的一些奇奇怪怪的问题

## 启动本地服务，停止，没有解除端口占用。
  问题描述：yarn start启动，Ctrl+C停止服务。在同一窗口启动服务，或者未关闭窗口在另一个窗口启动此服务，提示当前端口还在占用，并没有停止。
  环境：WIN 10，git bash
  原因：webpack-dev-server端口占用的问题
  解决方案：
    1. 使用windows自带的cmd执行 npm run dev ,可以通过 ctrl+c杀死node进程
    2. 直接在 git Bash 中  task kill node,直接kill node进程
    3. 多按几次ctrl+c(个人习惯此种方式)

  NOTE: 思考：有些项目没有这个问题，构建方式有何不同？
    cra 没有eject的的项目没有这个问题。脚手架的后端服务是怎么实现的？

- reference
  1. [windows系统下webpack-dev-server占用端口](https://juejin.cn/post/6844903609528745991)

<hr/>
## 前端
- 产生了什么问题？
  react组件里的checkbox上的监听事件不生效。
- 问题的背景？
  组件用react,antd,但整体项目是jsp。事件，请求使用requirejs,jquery。
  原来写在普通dom结构里的checkbox，点击事件正常。移动至react组件内checkbox的点击事件不生效，监听不见了。
  react是用script标签，以及babel运行时进行转换的。
- 分析原因？
  可能监听事件的函数在先，react的checkbox在后，监听事件没拿到对应的元素。所以将react的script标签移动至最前面，但未生效。
  通过简单的demo尝试，在cra脚手架的react组件里写checkbox,并在index.html添加dom事件，发现事件生效。所以与单纯的框架，组件没有关系，原因应该就是监听的元素丢失。
  为什么没有监听到对应的元素呢？通过在浏览器调试，添加监听的时候控制台打出这个元素，发现监听事件时的元素与在后面点击的元素不是一个😂
  为什么不是同一个元素了？监听事件是写在原来的结构里，使用requirejs，只加载一次，监听了第一次dom结构的对应元素。但碰巧的是，第一次dom里对应的checkbox是不显示的。在进行了其他的操作，使react重新渲染了，重新render，对应元素已经被卸载又重新加载了。
- 解决方案：
  在不移动针对此事件的各种操作的前提下，使用了事件委托，监听事件添加到了父元素或者爷爷元素等不变元素，通过e.target确定点击的范围，达到了想要的目的。
- 总结：
  之前在完全的react项目中，如果对一个元素添加事件，是在组件内部，didMount的时候添加监听，willUnmount的时候清楚监听。即使react重新渲染，也会在didmount的时候再添加监听，确保每次监听是生效的。而这次监听事件在react外，在重新渲染后监听事件丢失了。
- 再次总结：
  按照高内聚的思想，我把原来的checkbox移动至react里，但是针对他的行为，事件没有移动至react内，造成了这个问题。如果事件按照react组件内部的行为模式（didMount添加监听），不会产生监听失效的问题。但是原来针对此元素的事件，以及原生dom操作耦合性太强，比较复杂，暂且继续使用。移动至react内的工作量比较大，也可能会产生新的问题。

- 针对这个问题再说两句，不就是一个render重新渲染，对应元素卸载重新装载的问题嘛，不知不觉扯了这么多。😜
  为什么我把对应的checkbox移动到了react里，因为新加的一些功能，按照UI要使用antd.之前的一部分可以算作属于新加的大功能内部的，为了这部分的UI一致性。
  那为什么不把对应的事件，原来相关的所有逻辑都移动进来呢？没有移进来确实在整体的结构上不够好，至少我理解的是没有高内聚。但是目前的要求是业务优先，稳定是重要的。自己重构了这一小部分的逻辑，是没有对应的测试来帮忙覆盖的，只有自测，对自测并不是很自信...之前是有改某一块就把部分逻辑重构了，但是很危险..在公司人手不是很富裕的情况下，贸然重构的风险太大。

  在本菜菜的角度，原来的逻辑不是很清楚的情况下是不能贸然重构的。重构的基础是，你对原来的功能逻辑足够熟悉，能够和前端负责人，产品对整体的功能逻辑简单沟通。并在重构后，安排一定量的测试。但也有点理想化了...其实我也还不是很确定到底什么情况下可以重构? 现在不能贸然重构的想法，也是因为年轻理想化，私自改了几个逻辑，测试没有覆盖到，在生产环境才发现的问题。总之重构是需要衡量考虑的，不能贸贸然。

<hr/>
